% !TeX root=main.tex

\section{Network Architecture}
\label{sec:preliminaries}
The interconnection network modelled in this work is the fat-tree topology \cite{Al-FaresLV08}. The fat-tree or folded-Clos topology is currently the most common topology used for datacentre communication networks \cite{Cisco18}. The fat-tree topology is formed of many physical switches split into three layers: Core, Aggregation and Edge. Switches at the edge layer are additionally connected to servers. In an NFV enabled network each of these servers contains one or more VNFs which are managed by a virtual switch. The switches can direct packets towards any other network component they are connected to. In an SDN enabled network an SDN controller provides logically centralised management, instructing the switches how to route traffic to ensure it is routed through an efficient path from the source to destination VNF. Figure \ref{fig:network_topology} illustrates an SDN and NFV enabled fat-tree topology.

The fat-tree topology is dependent upon the number of ports at each switch. We define $k$ as the number of ports for each physical switch and $k_{vm}$ the number of ports for each virtual switch. There are $(k/2)^2$ core switches. Each core switch connects to one switch in each of $k$ pods. Each pod contains two layers (aggregation and edge) of $k/2$ switches. Each edge switch is connected to each of the $k/2$ aggregation switches of the pod. Each edge switch is connected to $k/2$ servers. Each server contains a virtual switch connected to $k_{vsw}$ VNFs. This topology results in $n=(k^3/4) \cdot k_{vsw}$ VNFs.

Whilst the SDN controller is logically centralised, in practice a physically centralised SDN architecture cannot scale to support a large datacentre network \cite{AzodolmolkyWY13}. A simple extension is the two layer hierarchical structure. In this architecture, a local SDN controller exists at or close to each server and an additional root SDN controller exists as an independent element. Arriving or produced packets are first evaluated at the local controller. If the local controller cannot process the packet it is sent to the root controller and then back to the server once resolved. As a result only a portion of the packets generated in the network will visit the root SDN controller. A comparable real world implementation is VMWare NSX \cite{VMW18} which as of 2016 had been deployed on over 2400 networks \cite{VMW16}. 

\begin{figure}

\centering

\begin{tikzpicture}[
every node/.style={node distance=6mm and 1mm},
server/.style={rectangle, draw=black, fill=black},
edge/.style={rectangle, draw=black, fill=black},
agg/.style={rectangle, draw=black, fill=black},
core/.style={rectangle, draw=black, fill=black},
sdn/.style={rectangle, draw=black, fill=black},
vm/.style={rectangle, draw=black, fill=black},
]

% Servers
\node[server]      (S1)                       {};
\node[server]      (S2)        [right=of S1]  {};
\node[server]      (S3)        [right=of S2]  {};
\node[server]      (S4)        [right=of S3]  {};
\node[server]      (S5)        [right=of S4]  {};
\node[server]      (S6)        [right=of S5]  {};
\node[server]      (S7)        [right=of S6]  {};
\node[server]      (S8)        [right=of S7]  {};
\node[server]      (S9)        [right=of S8]  {};
\node[server]      (S10)       [right=of S9]  {};
\node[server]      (S11)       [right=of S10] {};
\node[server]      (S12)       [right=of S11] {};
\node[server]      (S13)       [right=of S12] {};
\node[server]      (S14)       [right=of S13] {};
\node[server]      (S15)       [right=of S14] {};
\node[server]      (S16)       [right=of S15] {};

\node[text width=0.8cm] at (-2, 0)  {V.Switches};

% VMs
\node[vm]      (V1)        [below=of S1]  {};
\node[vm]      (V2)        [below=of S1, left=of V1]  {};
\node[vm]      (V3)        [below=of S1, right=of V1]  {};

\node[vm]      (V4)        [below=of S8]  {};
\node[vm]      (V5)        [below=of S8, left=of V4]  {};
\node[vm]      (V6)        [below=of S8, right=of V4]  {};

\node[vm]      (V7)        [below=of S15]  {};
\node[vm]      (V8)        [below=of S15, left=of V7]  {};
\node[vm]      (V9)        [below=of S15, right=of V7]  {};

\node[text width=0.8cm] at (-2, -.86)  {VNFs};
\node [between=V1 and V4] {\large ...};
\node [between=V6 and V7] {\large ...};

% SDN Controller
\node[text width=0.8cm] at (-2, .9)  {Controller};
\node[sdn]      (SC1)      	 [above left=of S1] {};

% Edge/ToR
% This weird hack stops Tikz from placing the points at the same level as the SDN Controller
%\node[bug_example]      (test)      [above=of SC1, between=S15 and S16] {};

\node[text width=0.8cm] at (-2, 1.75)  {Edge};
\node[] 		 (H1) 		 [above=of SC1] {};
\node[] 		 (H2) 		 [between=S1 and S2] {};
\node[] 		 (H3) 		 [between=S3 and S4] {};
\node[] 		 (H4) 		 [between=S5 and S6] {};
\node[] 		 (H5) 		 [between=S7 and S8] {};
\node[] 		 (H6) 		 [between=S9 and S10] {};
\node[] 		 (H7) 		 [between=S11 and S12] {};
\node[] 		 (H8) 		 [between=S13 and S14] {};
\node[] 		 (H9) 		 [between=S15 and S16] {};

\node[edge]      (E1)        [at = (H1 -| H2)] {};
\node[edge]      (E2)        [at = (H1 -| H3)] {};
\node[edge]      (E3)        [at = (H1 -| H4)] {};
\node[edge]      (E4)        [at = (H1 -| H5)] {};
\node[edge]      (E5)        [at = (H1 -| H6)] {};
\node[edge]      (E6)        [at = (H1 -| H7)] {};
\node[edge]      (E7)        [at = (H1 -| H8)] {};
\node[edge]      (E8)        [at = (H1 -| H9)] {};

% Aggregate
\node[text width=0.8cm] at (-2, 2.55)  {Aggregation};
\node[agg]      (A1)        [above=of E1] {};
\node[agg]      (A2)        [above=of E2] {};
\node[agg]      (A3)        [above=of E3] {};
\node[agg]      (A4)        [above=of E4] {};
\node[agg]      (A5)        [above=of E5] {};
\node[agg]      (A6)        [above=of E6] {};
\node[agg]      (A7)        [above=of E7] {};
\node[agg]      (A8)        [above=of E8] {};

% Core
\node[text width=0.8cm] at (-2, 3.3)  {Core};
\node[core]      (C1)        [above=of A1,  between=A1 and A2]  {};
\node[core]      (C2)        [above=of A3,  between=A3 and A4]  {};
\node[core]      (C3)        [above=of A5,  between=A5 and A6]  {};
\node[core]      (C4)        [above=of A7,  between=A7 and A8]  {};

%Lines
\draw[-] (V1.north)  -- (S1.south);
\draw[-] (V2.north)  -- (S1.south);
\draw[-] (V3.north)  -- (S1.south);

\draw[-] (V4.north)  -- (S8.south);
\draw[-] (V5.north)  -- (S8.south);
\draw[-] (V6.north)  -- (S8.south);

\draw[-] (V7.north)  -- (S15.south);
\draw[-] (V8.north)  -- (S15.south);
\draw[-] (V9.north)  -- (S15.south);

\draw[-] (S1.north)  -- (E1.south);
\draw[-] (S2.north)  -- (E1.south);
\draw[-] (S3.north)  -- (E2.south);
\draw[-] (S4.north)  -- (E2.south);
\draw[-] (S5.north)  -- (E3.south);
\draw[-] (S6.north)  -- (E3.south);
\draw[-] (S7.north)  -- (E4.south);
\draw[-] (S8.north)  -- (E4.south);
\draw[-] (S9.north)  -- (E5.south);
\draw[-] (S10.north) -- (E5.south);
\draw[-] (S11.north) -- (E6.south);
\draw[-] (S12.north) -- (E6.south);
\draw[-] (S13.north) -- (E7.south);
\draw[-] (S14.north) -- (E7.south);
\draw[-] (S15.north) -- (E8.south);
\draw[-] (S16.north) -- (E8.south);

\draw[-] (S1.north)  -- (SC1.south east);
\draw[-] (S2.north)  -- (SC1.south east);
\draw[-] (S3.north)  -- (SC1.south east);
\draw[-] (S4.north)  -- (SC1.south east);
\draw[-] (S5.north)  -- (SC1.south east);
\draw[-] (S6.north)  -- (SC1.south east);
\draw[-] (S7.north)  -- (SC1.south east);
\draw[-] (S8.north)  -- (SC1.south east);
\draw[-] (S9.north)  -- (SC1.south east);
\draw[-] (S10.north) -- (SC1.south east);
\draw[-] (S11.north) -- (SC1.south east);
\draw[-] (S12.north) -- (SC1.south east);
\draw[-] (S13.north) -- (SC1.south east);
\draw[-] (S14.north) -- (SC1.south east);
\draw[-] (S15.north) -- (SC1.south east);
\draw[-] (S16.north) -- (SC1.south east);

\draw[-] (E1.north)  -- (A1.south);
\draw[-] (E2.north)  -- (A2.south);
\draw[-] (E3.north)  -- (A3.south);
\draw[-] (E4.north)  -- (A4.south);
\draw[-] (E5.north)  -- (A5.south);
\draw[-] (E6.north)  -- (A6.south);
\draw[-] (E7.north)  -- (A7.south);
\draw[-] (E8.north)  -- (A8.south);

\draw[-] (E1.north)  -- (A2.south);
\draw[-] (E2.north)  -- (A1.south);
\draw[-] (E3.north)  -- (A4.south);
\draw[-] (E4.north)  -- (A3.south);
\draw[-] (E5.north)  -- (A6.south);
\draw[-] (E6.north)  -- (A5.south);
\draw[-] (E7.north)  -- (A8.south);
\draw[-] (E8.north)  -- (A7.south);

\draw[-] (A1.north)  -- (C1.south);
\draw[-] (A1.north)  -- (C3.south);
\draw[-] (A2.north)  -- (C2.south);
\draw[-] (A2.north)  -- (C4.south);
\draw[-] (A3.north)  -- (C1.south);
\draw[-] (A3.north)  -- (C3.south);
\draw[-] (A4.north)  -- (C2.south);
\draw[-] (A4.north)  -- (C4.south);
\draw[-] (A5.north)  -- (C1.south);
\draw[-] (A5.north)  -- (C3.south);
\draw[-] (A6.north)  -- (C2.south);
\draw[-] (A6.north)  -- (C4.south);
\draw[-] (A7.north)  -- (C1.south);
\draw[-] (A7.north)  -- (C3.south);
\draw[-] (A8.north)  -- (C2.south);
\draw[-] (A8.north)  -- (C4.south);

\end{tikzpicture}

\caption{An example SDN and NFV enabled fat-tree network with 4 ports for each hardware switch and 3 for the virtual switches.}

\label{fig:network_topology}

\end{figure}