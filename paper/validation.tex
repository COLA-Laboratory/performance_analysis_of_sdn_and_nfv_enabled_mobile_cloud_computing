% !TeX root=main.tex

\section{Validation}
\label{sec:validation}
The described model has been validated using a discrete event simulator. Each simulation experiment was run until the network reaches it's steady state where further network cycles do not change the collected statistics appreciably. 

Numerous validation experiments were performed for several combinations of network sizes, service lengths, number and probability of selection, filtering VNFs and $p_{user\_sdn}$. To remain concise, latency results are presented for selected cases. For all cases, where not otherwise specified, the following parameter settings are used:

\begin{itemize}
\item $k = 4$, $k_{vm} = 2$ and $p_{sdn_user} = 0$
\item All switches have the same service rate of 40 messages per cycle
\item The VNFs have a service rate of 20 messages per cycle
\item One service with two VNFs is used
\item Services are selected with equal probability
\end{itemize}

Additionally, when multiple services in the same network are considered (\pref{fig:mult_services}) each service is assigned a length the same as it's index plus one. As a consequence, tests with more services have higher average lengths.

Figures \ref{fig:num_ports} to \ref{fig:filtering_vnfs} depict mean message latency predicted by the model plotted against those provided by a discrete event simulator for a range of parameter settings. Results are only shown where the network is in a steady state, i.e. where the arrival rate for any network element is lower or equal to the service rate at the element. The figures demonstrate that the simulation results closely match that predicted by the model. The tractability and accuracy of the model analytical model make it suitable for analysis of next generation NFV and SDN enabled communications networks.

\pgfplotsset{every axis/.append style={
font = \large,
%grid = major,
ylabel = {Latency (Cycles)},
thick,
line width = 1pt,
tick style = {line width = 0.8pt},
axis x line*=bottom,
axis y line*=left,
ymin = 0,
xmin = 0
}}

% Different Number of Ports
\begin{figure}

\label{fig:num_ports}

\begin{tikzpicture}
	\begin{axis}[ 
		xlabel=$\lambda_{new}$ (messages/cycle),
		width=0.48\textwidth,
		height=.23\paperheight,
		xmin = 0.1,
		restrict y to domain=0:10,
		legend pos = north east,
		legend entries = {$k=2$,, $k=4$,, $k=8$},
		clip marker paths=true,
		legend cell align={left},
        legend style={font=\normalsize},
		] 

	\addplot [blue, mark = none, dotted] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_IncreasingNumPorts_2.out};
	\addplot [blue, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_IncreasingNumPorts_2.out};
	
	\addplot [red, mark = none, dashed] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_IncreasingNumPorts_4.out};
	\addplot [red, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_IncreasingNumPorts_4.out};
	
	\addplot [black, mark = none] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_IncreasingNumPorts_8.out};	
	\addplot [black, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_IncreasingNumPorts_8.out};

	\end{axis} 
\end{tikzpicture}

\caption{Latency predicted by the model and simulation for different numbers of ports ($k$).}

\end{figure}

% Different SDN Percentages
\begin{figure}

\label{fig:sdn_perc}

\begin{tikzpicture}
	\begin{axis}[ 
		xlabel=$\lambda_{new}$ (messages/cycle),
		width=0.48\textwidth,
		height=.23\paperheight,
		xmin = 0.1,
		restrict y to domain=0:10,
		legend pos = north west,
		legend entries = {$p_{sdn\_user}=.1$,, $p_{sdn\_user}=.5$,, $p_{sdn\_user}=1$, Simulation},
		clip marker paths=true,
		legend cell align={left},
        legend style={font=\normalsize},
		] 

	\addplot [blue, mark = none, dotted] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_SDN_10.out};
	\addplot [blue, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_IncreasingSDN_10.out};	
	
	\addplot [red, mark = none, dashed] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_SDN_50.out};
	\addplot [red, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_IncreasingSDN_50.out};	
	
	\addplot [black, mark = none] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_SDN_100.out};
	\addplot [black, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_IncreasingSDN_100.out};

	\end{axis} 
\end{tikzpicture}

\caption{Latency predicted by the model and simulation with different proportions of messages routing via the SDN controller.}

\end{figure}

% Different Length Service Chains
\begin{figure}

\label{fig:length_chain}

\begin{tikzpicture}
	\begin{axis}[ 
		width=0.48\textwidth,
		height=.23\paperheight,
		xlabel=$\lambda_{new}$ (messages/cycle),
		xmin=0.1,
		restrict y to domain=0:10,
		legend pos = north east,
		legend entries = {2 VNFs,, 3 VNFs,, 5 VNFs,, 8 VNFs, Simulation},
		clip marker paths=true,
		legend cell align={left},
        legend style={font=\normalsize},
		] 

	\addplot [blue, mark = none, dotted] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_DifferentLengths_1.out};
	\addplot [blue, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_DifferentLengths_1.out};	
	
	\addplot [red, mark = none, dashed] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_DifferentLengths_2.out};
	\addplot [red, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_DifferentLengths_2.out};	
	
	\addplot [purple, mark = none, densely dotted] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_DifferentLengths_4.out};
	\addplot [purple, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_DifferentLengths_4.out};	
	
	\addplot [black, mark = none] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_DifferentLengths_8.out};
	\addplot [black, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_DifferentLengths_8.out};	

	\end{axis} 
\end{tikzpicture}

\caption{Latency predicted by the model and simulation for different length service chains.}

\end{figure}

\vfill

% Multiple Services
\begin{figure}

\label{fig:mult_services}

\begin{tikzpicture}
	\begin{axis}[ 
		xlabel=$\lambda_{new}$ (messages/cycle),
		xmin=0.1,		
		restrict y to domain=0:10,
		width=.48\textwidth,
		height=.23\paperheight,
		legend pos = north west,
		legend entries = {1 Service,, 2 Services,, 4 Services, Simulation},
		clip marker paths=true,
		legend cell align={left},
        legend style={font=\normalsize},
		] 

	\addplot [blue, mark = none, dotted] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_MultipleServices_1.out};
	\addplot [blue, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_MultipleServices_1.out};	
	
	\addplot [red, mark = none, dashed] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_MultipleServices_2.out};
	\addplot [red, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_MultipleServices_2.out};	
	
	\addplot [black, mark = none] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_MultipleServices_4.out};
	\addplot [black, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_MultipleServices_4.out};	
	
	\end{axis} 
\end{tikzpicture}

\caption{Latency predicted by the model and simulation for several services of different lengths.}

\end{figure}

% Filtering VNFs
\begin{figure}

\label{fig:filtering_vnfs}

\begin{tikzpicture}
	\begin{axis}[ 
		xlabel=$\lambda_{new}$ (messages/cycle),
		xmin=0.1,		
		restrict y to domain=0:10,
		width=.48\textwidth,
		height=.23\paperheight,
		legend pos = north west,
		legend entries = {0\% Filtered,, 40\% Filtered,, 80\% Filtered, Simulation},
		clip marker paths=true,
		legend cell align={left},
        legend style={font=\normalsize},
		] 

	\addplot [blue, mark = none, dotted] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_FilteringVNFs_100.out};
	\addplot [blue, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_FilteringVNFs_100.out};	
	
	\addplot [red, mark = none, dashed] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_FilteringVNFs_60.out};
	\addplot [red, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_FilteringVNFs_60.out};		
	
	\addplot [black, mark = none] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/MODEL_FilteringVNFs_20.out};
	\addplot [black, only marks, mark = x, mark size = 2pt] table[x index = 0, y index = 1] {/media/joebillingsley/Data/projects/NFV_FatTree/out/data/SIMULATION_FilteringVNFs_20.out};	

	\end{axis} 
\end{tikzpicture}

\caption{Latency predicted by the model and simulation for a three long service chain where the second VNF only forwards a portion of the traffic.}

\end{figure}
